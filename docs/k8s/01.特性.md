# 特性

## 1. 服务发现和负载均衡
> Service discovery and load balancing

> 每个服务实例可以用 `IP` 和 `端口号` 表示. 在基于 `云端` 和 `微服务` 复杂的应用场景下, 每个服务一般部署多个实例, 且为了高可用实例都会动态变动(加减实例,分批重启升级) `IP` 和 `端口号` 也会动态变更, 因此需要一种服务发现机制, 保证服务和客户端的高可用稳定性. 服务发现有两大模式: 客户端发现模式和服务端发现模式.

### 客户端发现模式

> 客户端查询服务注册表, 获取可用服务实例网络位置, 然后使用负载均衡算法从多个服务实例中选择出一个.

- https://github.com/Netflix/eureka
- https://github.com/apache/incubator-dubbo

#### 优点

> 简单直接, 除服务注册外, 其他部分无需变动. 由于客户端知道所有的服务实例, 能针对特定的应用实现特定的负载算法, 如使用哈希一致性.

#### 缺点

> 客户端与服务注册绑定, 要针对服务端用到的编程语言和框架实现客户端的服务发现逻辑.

### 服务端发现模式

> 客户端通过负载均衡器向某个服务发起请求, 负载均衡器查询服务注册表, 并将请求转发到可用的服务实例.

- AWS Elastic Load Balancer (ELB)
- Nginx/Nginx Plus

#### 优点

> 客户端无需关注发现细节, 只需要简单地向负载均衡器发送请求.

#### 缺点

> 除非负载均衡器由部署环境提供, 否则会成为一个需要配置和管理的高可用系统组件.

### 服务注册表

- Netflix Eureka https://github.com/Netflix/eureka
- etcd https://github.com/etcd-io/etcd
- consul https://github.com/hashicorp/consul
- Apache ZooKeeper https://github.com/apache/zookeeper

### 服务注册方式

#### 自注册方式

> eg: Eureka. 优点: 相对简单, 无需其他系统组件. 缺点: 服务实例和服务注册表耦合, 必须在每个编程语言和框架内实现注册代码.

#### 第三方注册方式

> 第三方注册模式, 服务实例不需要向服务注册表注册. 相反, 被称为服务注册器的另一个系统模块会处理. 服务注册器会通过查询部署环境或订阅事件的方式来跟踪运行实例的更改. 一旦侦测到有新的可用服务实例, 会向注册表注册此服务. 服务管理器也负责注销终止的服务实例. 优点: 服务与服务注册表解耦合, 无需为每个编程语言和框架实现服务注册逻辑. 缺点: 服务实例通过一个专有的服务以中心化的方式进行管理, 除非该服务内置于部署环境, 否则需要配置和管理一个高可用的系统组件.

- https://github.com/gliderlabs/registrator
- https://github.com/Netflix/Prana

### 参考

- https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/
